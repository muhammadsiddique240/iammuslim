{% extends "base.html" %}

{% block title %}Search | iammuslim{% endblock %}

{% block content %}
  <div class="rounded-2xl border border-slate-200 bg-white p-6">
    <div class="flex flex-col gap-2 sm:flex-row sm:items-end sm:justify-between">
      <div>
        <h1 class="text-xl font-semibold">Search</h1>
        <div class="mt-1 text-sm text-slate-600">Quran: {{ counts.quran }} · Hadith: {{ counts.hadith }} · Azkar: {{ counts.azkar }} · Research: {{ counts.research }}</div>
      </div>
    </div>

    {% if not query %}
      <div class="mt-6 text-sm text-slate-600">Type a query in the search box above.</div>
    {% else %}
      <div class="mt-6 grid gap-3">
        {% if page_obj.object_list %}
          {% for item in page_obj.object_list %}
            {% with kind=item.0 obj=item.1 %}
              <div class="rounded-xl border border-slate-200 bg-slate-50 p-4">
                <div class="flex flex-wrap items-center justify-between gap-2">
                  <div class="text-xs font-medium uppercase tracking-wide text-emerald-700">{{ kind }}</div>
                  {% if kind == 'quran' %}
                    <a class="text-xs text-slate-600 hover:text-emerald-700" href="{% url 'quran:surah_detail' obj.surah.slug %}">Open Surah</a>
                  {% elif kind == 'hadith' %}
                    <a class="text-xs text-slate-600 hover:text-emerald-700" href="{% url 'hadith:chapter_detail' obj.chapter.book.slug obj.chapter.slug %}">Open Chapter</a>
                  {% elif kind == 'research' %}
                    <a class="text-xs text-slate-600 hover:text-emerald-700" href="{% url 'research:paper_detail' obj.slug %}">Open Paper</a>
                  {% endif %}
                </div>

                {% if kind == 'quran' %}
                  <div class="mt-2 text-sm text-slate-600">{{ obj.surah.number }}:{{ obj.number_in_surah }}</div>
                  <div class="mt-2 text-lg leading-relaxed font-ar">{{ obj.text_ar }}</div>
                  {% if obj.translation_ur %}
                    <div class="mt-3 text-base leading-relaxed font-ur">{{ obj.translation_ur }}</div>
                  {% endif %}
                {% elif kind == 'hadith' %}
                  <div class="mt-2 text-sm text-slate-600">{{ obj.chapter.book.title }} · {{ obj.chapter.title }} · {{ obj.grade|capfirst }}</div>
                  {% if obj.text_ar %}<div class="mt-2 text-lg leading-relaxed font-ar">{{ obj.text_ar }}</div>{% endif %}
                  {% if obj.text_ur %}<div class="mt-3 text-base leading-relaxed font-ur">{{ obj.text_ur }}</div>{% endif %}
                {% elif kind == 'azkar' %}
                  <div class="mt-2 text-sm text-slate-600">{% if obj.category %}{{ obj.category.title }} · {% endif %}{{ obj.time_of_day|capfirst }}</div>
                  {% if obj.arabic %}<div class="mt-2 text-lg leading-relaxed font-ar">{{ obj.arabic }}</div>{% endif %}
                  {% if obj.urdu %}<div class="mt-3 text-base leading-relaxed font-ur">{{ obj.urdu }}</div>{% endif %}
                {% elif kind == 'research' %}
                  <div class="mt-2 text-sm text-slate-600">{{ obj.author }}{% if obj.published_at %} · {{ obj.published_at }}{% endif %}</div>
                  <div class="mt-2 text-base font-medium">{{ obj.title }}</div>
                  {% if obj.summary %}<div class="mt-2 text-sm text-slate-700">{{ obj.summary|truncatechars:220 }}</div>{% endif %}
                {% endif %}
              </div>
            {% endwith %}
          {% endfor %}

          {% include "partials/pagination.html" %}
        {% else %}
          <div class="text-sm text-slate-600">No results found.</div>
        {% endif %}
      </div>
    {% endif %}
  </div>
{% endblock %}
